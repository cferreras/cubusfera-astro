---
import { AlertCircle, CheckCircle, Info, AlertTriangle, WifiOff } from "lucide-react";

interface Props {
    type?: "error" | "offline" | "info" | "warning";
    title?: string;
    message: string;
    showHelpText?: boolean;
    helpText?: string;
    className?: string;
}

const {
    type = "error",
    title,
    message,
    showHelpText = false,
    helpText,
    className = "",
} = Astro.props;

const isServerOffline =
    type === "offline" ||
    message.includes("servidor") ||
    message.includes("desconectado");

const getStyles = () => {
    if (isServerOffline) {
        return {
            container: "bg-muted/50 border-border",
            iconWrapper: "bg-muted text-muted-foreground",
            icon: WifiOff,
            title: "text-foreground",
            message: "text-muted-foreground",
        };
    }

    switch (type) {
        case "warning":
            return {
                container: "bg-yellow-500/10 border-yellow-500/20",
                iconWrapper: "bg-yellow-500/20 text-yellow-600 dark:text-yellow-400",
                icon: AlertTriangle,
                title: "text-yellow-700 dark:text-yellow-300",
                message: "text-yellow-600 dark:text-yellow-400",
            };
        case "info":
            return {
                container: "bg-blue-500/10 border-blue-500/20",
                iconWrapper: "bg-blue-500/20 text-blue-600 dark:text-blue-400",
                icon: Info,
                title: "text-blue-700 dark:text-blue-300",
                message: "text-blue-600 dark:text-blue-400",
            };
        case "error":
        default:
            return {
                container: "bg-red-500/10 border-red-500/20",
                iconWrapper: "bg-red-500/20 text-red-600 dark:text-red-400",
                icon: AlertCircle,
                title: "text-red-700 dark:text-red-300",
                message: "text-red-600 dark:text-red-400",
            };
    }
};

const styles = getStyles();
const Icon = styles.icon;

const defaultTitle = isServerOffline
    ? "Servidor desconectado"
    : type === "warning"
      ? "Advertencia"
      : type === "info"
        ? "Información"
        : "Error";

const displayTitle = title || defaultTitle;

const defaultHelpText = isServerOffline
    ? " Esto es normal cuando el servidor está apagado. La web funciona correctamente."
    : helpText;

const shouldShowHelp =
    showHelpText || (isServerOffline && !helpText) || helpText;
---

<div class={`p-6 text-center border rounded-xl ${styles.container} ${className}`}>
    <div class={`flex items-center justify-center w-12 h-12 mx-auto mb-4 rounded-full ${styles.iconWrapper}`}>
        <Icon className="w-6 h-6" />
    </div>

    <h3 class={`mb-2 text-lg font-semibold ${styles.title}`}>
        {displayTitle}
    </h3>

    <p class={`text-sm ${styles.message}`}>
        {message}
    </p>

    {shouldShowHelp && (
        <p class="mt-4 text-xs text-muted-foreground bg-background/50 py-2 px-3 rounded-lg inline-block">
            {defaultHelpText}
        </p>
    )}
</div>
